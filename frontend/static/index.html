<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
</head>
<body>
    <h1>Todo List</h1>
    <input type="text" id="newItem" placeholder="Enter a new item">
    <button onclick="addItem()">Add</button>
    <ul id="todoList"></ul>
    <script>
const API_URL =
  window.location.hostname === 'localhost'
    ? 'http://localhost:8000'
    : 'http://backend:8000';

        async function fetchTodos() {
            try {
                const response = await fetch(`${API_URL}/todos`);
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                const todos = await response.json();
                const list = document.getElementById('todoList');
                list.innerHTML = '';
                todos.forEach(todo => {
                    const li = document.createElement('li');
                    li.textContent = todo.content;
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.onclick = () => deleteItem(todo._id);
                    li.appendChild(deleteBtn);
                    list.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching todos:', error);
                const list = document.getElementById('todoList');
                list.innerHTML = '<li style="color: red;">Error: Could not connect to server. Make sure the backend is running on ' + API_URL + '</li>';
            }
        }

        async function addItem() {
            const input = document.getElementById('newItem');
            const content = input.value;
            
            if (content.trim() === '') {
                alert('Please enter a todo item');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/todos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: content })
                });
                
                if (response.ok) {
                    input.value = '';
                    fetchTodos();
                } else {
                    alert('Failed to add todo. Server returned: ' + response.status);
                }
            } catch (error) {
                console.error('Error adding todo:', error);
                alert('Error: Could not connect to server. Make sure the backend is running on ' + API_URL);
            }
        }

        async function deleteItem(id) {
            try {
                const response = await fetch(`${API_URL}/todos/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    fetchTodos();
                } else {
                    alert('Failed to delete todo');
                }
            } catch (error) {
                console.error('Error deleting todo:', error);
                alert('Error: Could not connect to server');
            }
        }

        // Load todos when page loads
        fetchTodos();
    </script>
</body>
</html>

